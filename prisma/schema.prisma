
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGO_DATABASE_URL")
}

model Product {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  name             String   @db.String
  description      String   @db.String
  trackUrl         String?  @db.String
  code             String   @db.String
  category         String   @db.String
  createdAt        DateTime @default(now())
  salePrice        Float?   
  purchasePrice    Float?   
  supplier         String  
  
  company Company @relation(fields: [companyId], references: [id])
  companyId        String   @db.ObjectId

  transaction Transaction @relation(fields: [transactionId], references: [id])
  transactionId        String   @db.ObjectId

  virtualStock VirtualStock @relation(fields: [virtualStockId], references: [id])
  virtualStockId        String   @db.ObjectId
  
  photoUrl         String?  @db.String
  technicalDetails Json?    @db.Json
  quantityInStock  Int      @db.Int
  updatedAt        DateTime @updatedAt

  @@index([companyId])
}


model Company {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  name     String   @db.String
  email    String   @unique @db.String
  password String   @db.String
  photoUrl String?  @db.String
  category String   @db.String

  products Product[]
  employees Employee[]
  transactions Transaction[]
  reports Report[]
  notifications Notification[]
  virtualStocks VirtualStock[]
}


model Employee {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @db.String
  email     String   @unique @db.String
  password  String   @db.String
  role      String   @db.String
  
  company Company @relation(fields: [companyId], references: [id])
  companyId String   @db.ObjectId
  
  photoUrl  String?  @db.String
  createdAt DateTime @default(now())

  @@index([companyId])
}


model Transaction {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  type          String   @db.String
  createdAt     DateTime @default(now())
  createdBy     String   @db.String
  
  products      Product[]

  total         Float  
  paymentMethod String   @db.String

  buyer       String   
  seller      String

  fileUrl       String?  @db.String

  company Company @relation(fields: [companyId], references: [id])
  companyId String   @db.ObjectId

}

model Report {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt  DateTime @default(now()) 
  period     String   @db.String
  fileUrl    String?  @db.String

  company Company @relation(fields: [companyId], references: [id])
  companyId String   @db.ObjectId

  @@index([companyId])
}

model Notification {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime @default(now()) 
  createdBy   String   
  description String   @db.String
  tags        String[] 

  company Company @relation(fields: [companyId], references: [id])
  companyId String   @db.ObjectId

  @@index([companyId])
}

model VirtualStock {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String   @db.String
  createdAt   DateTime @default(now())
  products    Product[] 
  description  String
  categories  String[]
  place       String?  @db.String
  code        String   @db.String

  company Company @relation(fields: [companyId], references: [id])
  companyId String   @db.ObjectId

  @@index([companyId])
}
